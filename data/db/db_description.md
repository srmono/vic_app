# üìò Vasavi Info Center ‚Äì Database Schema Documentation

## üìå Overview

This database powers the **Vasavi Info Center**, an ecosystem for managing community sections, service units, events, classifieds, businesses, and administration ‚Äî with **optional support for blogging/news and security features** like audit trails, login tokens, and activity logs.

---

## üîß Core Tables

### 1. `locations`
- **Purpose**: Stores hierarchical location data: Countries, States, Districts, Cities.
- **Relations**:
  - `users`, `events`, `business_listings`, etc., reference this table.
  - `parent_id` enables nesting (e.g., City under District).
- **Example**: India > Telangana > Hyderabad.

---

### 2. `users`
- **Purpose**: Stores community member profiles including admins, promoters, and members.
- **Key Fields**: Role, Phone (unique), Email, Password Hash.
- **Security**: Optionally supports 2FA via `is_2fa_enabled`.
- **Relations**:
  - Referenced by `admin_centers`, `uploads`, `city_section_promoters`, etc.

---

### 3. `sections`
- **Purpose**: Represents different community sections (e.g., Social Welfare, Health).
- **Relations**:
  - Mapped to locations via `city_sections`.

---

### 4. `city_sections`
- **Purpose**: Maps sections to cities for localized structure.
- **Relations**:
  - Linked to `service_units`, `city_section_promoters`.

---

### 5. `service_units`
- **Purpose**: Stores operational units within city sections.
- **Fields**: Includes contact details, address, and optional images (stored as JSON).
- **Relations**:
  - Used by `uploads`.

---

### 6. `city_section_promoters`
- **Purpose**: Assigns promoters to specific city sections.
- **Fields**: Includes contact info in JSON format.

---

### 7. `uploads`
- **Purpose**: Stores metadata for uploaded files (images, documents).
- **Improvements**:
  - Tracks `original_file_name`, `file_type`, `file_size`.
  - Associates files with `service_units` or `users`.
- **Security Tip**: Filenames should be uniquely generated by the backend.

---

### 8. `events`
- **Purpose**: Represents community events with image support.
- **Relations**:
  - Created by a user and linked to a location.

---

### 9. `subscriptions`
- **Purpose**: Captures newsletter subscriptions.

---

### 10. `business_categories`
- **Purpose**: Master table for categorizing businesses.

---

### 11. `business_listings`
- **Purpose**: Stores user-submitted business ads with optional contact info, logo, and website.

---

### 12. `classifieds`
- **Purpose**: Manages job and business classifieds posted by users.

---

### 13. `admin_centers`
- **Purpose**: Links admin users to locations they manage.

---

### 14. `news_categories`
- **Purpose**: Master list for categorizing blog/news content.

---

### 15. `news_articles`
- **Purpose**: Blog or news posts with image support.
- **Relations**:
  - Linked to author (`created_by`) and category.

---

## üîê Security & Optional Tables

### 16. `user_tokens`
- **Purpose**: Manages login sessions or API access tokens.
- **Fields**:
  - Token string, device info, IP address, expiry.
- **Usage**: Useful for multi-device login, logout tracking, and session expiry.

---

### 17. `audit_logs`
- **Purpose**: Captures data change history (insert/update/delete).
- **Fields**:
  - Table name, record ID, user ID, action type, before/after data (as JSON).
- **Use Case**: Critical for sensitive data monitoring and compliance.

---

### 18. `failed_logins`
- **Purpose**: Logs unsuccessful login attempts for brute-force detection.
- **Fields**: Phone/email, IP address, timestamp.

---

### 19. `activity_logs`
- **Purpose**: Records general user activity (logins, updates, access).
- **Fields**: Action, target table, target ID, description, IP, user agent.

---

### 20. `ip_whitelist` / `ip_blacklist`
- **Purpose**: Controls access to admin areas or APIs.
- **Usage**: Can restrict backend access to specific IPs.

---

### 21. `email_verification_tokens`
- **Purpose**: Stores tokens sent for email verification during signup.
- **Fields**: Email, token, expiry time.

---

### 22. `password_reset_tokens`
- **Purpose**: Allows users to securely reset forgotten passwords.
- **Fields**: Email, token, expiry time.

---

## üìÇ Data Storage & File Handling

- **Uploads Table**:
  - Stores both `original_file_name` and server `file_path`.
  - Include optional thumbnail paths if needed.
- **Backend Responsibility**:
  - Validate file type, size.
  - Sanitize paths and ensure unique storage.
  - Delete old files on update (via backend logic).

---

## üîÅ Relationships (Simplified Overview)

| Table                    | Linked To                                |
|--------------------------|-------------------------------------------|
| `users`                 | `uploads`, `events`, `admin_centers`      |
| `locations`             | `users`, `events`, `business_listings`    |
| `city_sections`         | `sections`, `locations`                   |
| `service_units`         | `city_sections`, `uploads`                |
| `news_articles`         | `users`, `news_categories`                |
| `audit_logs`            | All tables (generic log storage)          |
| `user_tokens`           | `users`                                   |

---

## ‚úÖ Best Practices & Security Reminders

- Use **password hashing (e.g., bcrypt)** ‚Äî never store plaintext passwords.
- Always **validate and sanitize** user input in your backend.
- Implement **TLS/SSL** in all backend communication.
- Consider **token expiration & refresh logic**.
- Log sensitive changes using `audit_logs`.
- Use `user_tokens` for mobile apps / APIs.

